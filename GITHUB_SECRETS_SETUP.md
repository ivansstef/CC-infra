# üîê –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è GitHub Secrets –¥–ª—è CI/CD

## –ù–∞–≤—ñ—â–æ –ø–æ—Ç—Ä—ñ–±–Ω—ñ Secrets?

GitHub Secrets –¥–æ–∑–≤–æ–ª—è—é—Ç—å –±–µ–∑–ø–µ—á–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —á—É—Ç–ª–∏–≤—ñ –¥–∞–Ω—ñ (SSH –∫–ª—é—á—ñ, –ø–∞—Ä–æ–ª—ñ, IP –∞–¥—Ä–µ—Å–∏) —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —ó—Ö –≤ GitHub Actions **–±–µ–∑** –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—Å—Ç—ñ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ —ó—Ö –≤ –∫–æ–¥—ñ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é.

## üìã –ù–µ–æ–±—Ö—ñ–¥–Ω—ñ Secrets

### –î–ª—è —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏ (deploy_infra.yml):

| Secret Name | –û–ø–∏—Å | –ü—Ä–∏–∫–ª–∞–¥ |
|------------|------|---------|
| `SERVER_IP` | IP –∞–¥—Ä–µ—Å–∞ –≤–∞—à–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ | `203.0.113.1` –∞–±–æ `myserver.com` |
| `SSH_USER` | –Ü–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ SSH | `ubuntu`, `root`, `admin` |
| `SSH_PORT` | –ü–æ—Ä—Ç SSH (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ) | `22` (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º), `2222` |
| `SSH_PRIVATE_KEY` | –ü—Ä–∏–≤–∞—Ç–Ω–∏–π SSH –∫–ª—é—á | –í–º—ñ—Å—Ç —Ñ–∞–π–ª—É `~/.ssh/id_rsa` |

### –î–ª—è —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫—É (deploy_app.yml):

| Secret Name | –û–ø–∏—Å | –ü—Ä–∏–∫–ª–∞–¥ |
|------------|------|---------|
| `DOCKER_USERNAME` | Docker Hub username | `yourusername` |
| `DOCKER_PASSWORD` | Docker Hub token/password | Docker Hub Access Token |

## üöÄ –Ø–∫ –¥–æ–¥–∞—Ç–∏ Secrets –≤ GitHub

### –ö—Ä–æ–∫ 1: –ü–µ—Ä–µ–π–¥—ñ—Ç—å –≤ Settings —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ –≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π –Ω–∞ GitHub: `https://github.com/ivansstef/CC-infra`
2. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **Settings** (‚öôÔ∏è) —É –≤–µ—Ä—Ö–Ω—å–æ–º—É –º–µ–Ω—é
3. –í –ª—ñ–≤–æ–º—É –º–µ–Ω—é –∑–Ω–∞–π–¥—ñ—Ç—å **Secrets and variables** ‚Üí **Actions**
4. –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å **New repository secret**

### –ö—Ä–æ–∫ 2: –î–æ–¥–∞–π—Ç–µ –∫–æ–∂–µ–Ω Secret

#### SERVER_IP
```
Name: SERVER_IP
Value: 203.0.113.1  (–∞–±–æ –≤–∞—à —Ä–µ–∞–ª—å–Ω–∏–π IP)
```

#### SSH_USER
```
Name: SSH_USER
Value: ubuntu  (–∞–±–æ –≤–∞—à–µ —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞)
```

#### SSH_PORT (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
```
Name: SSH_PORT
Value: 22  (–∞–±–æ –≤–∞—à –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –ø–æ—Ä—Ç, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ 2222)
```

**–ü—Ä–∏–º—ñ—Ç–∫–∞:** –Ø–∫—â–æ SSH_PORT –Ω–µ –≤–∫–∞–∑–∞–Ω–æ, –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –ø–æ—Ä—Ç 22.

#### SSH_PRIVATE_KEY

**–í–∞–∂–ª–∏–≤–æ!** –¶–µ –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –≤–∞—à –ø—Ä–∏–≤–∞—Ç–Ω–∏–π –∫–ª—é—á:

```bash
# –°–∫–æ–ø—ñ—é–π—Ç–µ –≤–º—ñ—Å—Ç –≤–∞—à–æ–≥–æ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞:
cat ~/.ssh/id_rsa
```

–°–∫–æ–ø—ñ—é–π—Ç–µ **–≤–µ—Å—å** –≤–º—ñ—Å—Ç (–≤–∫–ª—é—á–∞—é—á–∏ —Ä—è–¥–∫–∏ `-----BEGIN` —Ç–∞ `-----END`):

```
Name: SSH_PRIVATE_KEY
Value: 
-----BEGIN OPENSSH PRIVATE KEY-----
b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
...–≤–µ—Å—å –∫–ª—é—á...
-----END OPENSSH PRIVATE KEY-----
```

#### DOCKER_USERNAME
```
Name: DOCKER_USERNAME
Value: yourdockerhubusername
```

#### DOCKER_PASSWORD

**–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ:** –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ Access Token –∑–∞–º—ñ—Å—Ç—å –ø–∞—Ä–æ–ª—è

–Ø–∫ —Å—Ç–≤–æ—Ä–∏—Ç–∏ Docker Hub Access Token:
1. –ó–∞–π–¥—ñ—Ç—å –Ω–∞ https://hub.docker.com/
2. Account Settings ‚Üí Security ‚Üí New Access Token
3. –°—Ç–≤–æ—Ä—ñ—Ç—å —Ç–æ–∫–µ–Ω –∑ –Ω–∞–∑–≤–æ—é "GitHub Actions"
4. –°–∫–æ–ø—ñ—é–π—Ç–µ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π —Ç–æ–∫–µ–Ω

```
Name: DOCKER_PASSWORD
Value: dckr_pat_xxxxxxxxxxxxxxxxxxxx  (–≤–∞—à —Ç–æ–∫–µ–Ω)
```

## üìù –Ø–∫ –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ SSH –∫–ª—é—á (—è–∫—â–æ —É –≤–∞—Å –π–æ–≥–æ –Ω–µ–º–∞—î)

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è –Ω–æ–≤–æ–≥–æ SSH –∫–ª—é—á–∞
ssh-keygen -t ed25519 -C "github-actions@cinema-club"

# –ö–æ–ø—ñ—é–≤–∞–Ω–Ω—è –ø—É–±–ª—ñ—á–Ω–æ–≥–æ –∫–ª—é—á–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
ssh-copy-id -i ~/.ssh/id_ed25519.pub ubuntu@your-server-ip

# –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
ssh -i ~/.ssh/id_ed25519 ubuntu@your-server-ip
```

## ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

### 1. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ Secrets

–ü—ñ—Å–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö secrets, –≤–∏ –ø–æ–±–∞—á–∏—Ç–µ —ó—Ö —Å–ø–∏—Å–æ–∫ –≤ Settings ‚Üí Secrets:

```
‚úì SERVER_IP
‚úì SSH_USER
‚úì SSH_PORT (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
‚úì SSH_PRIVATE_KEY
‚úì DOCKER_USERNAME
‚úì DOCKER_PASSWORD
```

### 2. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –¥–µ–ø–ª–æ—é —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏

–ü–µ—Ä–µ–π–¥—ñ—Ç—å –≤ **Actions** ‚Üí **Deploy Infrastructure** ‚Üí **Run workflow**

Pipeline –ø–æ–≤–∏–Ω–µ–Ω:
1. ‚úÖ –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ Ansible
2. ‚úÖ –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ SSH
3. ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è
4. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç–∏ Ansible playbook
5. ‚úÖ –†–æ–∑–≥–æ—Ä–Ω—É—Ç–∏ Cinema Club

### 3. –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –¥–µ–ø–ª–æ—é –¥–æ–¥–∞—Ç–∫—É

–ü–µ—Ä–µ–π–¥—ñ—Ç—å –≤ **Actions** ‚Üí **Deploy Application** ‚Üí **Run workflow**

Pipeline –ø–æ–≤–∏–Ω–µ–Ω:
1. ‚úÖ –ó—ñ–±—Ä–∞—Ç–∏ Docker image
2. ‚úÖ –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –Ω–∞ Docker Hub
3. ‚úÖ –ó–∞–¥–µ–ø–ª–æ—ó—Ç–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
4. ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å

## üîí –ë–µ–∑–ø–µ–∫–∞

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ñ –ø—Ä–∞–∫—Ç–∏–∫–∏:

- Secrets **–Ω—ñ–∫–æ–ª–∏** –Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è –≤ –ª–æ–≥–∞—Ö
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ Access Tokens –∑–∞–º—ñ—Å—Ç—å –ø–∞—Ä–æ–ª–µ–π
- –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–Ω–æ–≤–ª—é–π—Ç–µ –∫–ª—é—á—ñ
- –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ä—ñ–∑–Ω—ñ –∫–ª—é—á—ñ –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â

### ‚ùå –ù–µ —Ä–æ–±—ñ—Ç—å —Ç–∞–∫:

- ‚ùå –ù–µ –¥–æ–¥–∞–≤–∞–π—Ç–µ IP –∞–¥—Ä–µ—Å–∏ –≤ –∫–æ–¥
- ‚ùå –ù–µ –∫–æ–º—ñ—Ç—å—Ç–µ SSH –∫–ª—é—á—ñ
- ‚ùå –ù–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –æ–¥–∏–Ω –∫–ª—é—á –¥–ª—è –≤—Å—å–æ–≥–æ
- ‚ùå –ù–µ –¥–æ–¥–∞–≤–∞–π—Ç–µ secrets –≤ pull requests –≤—ñ–¥ —Å—Ç–æ—Ä–æ–Ω–Ω—ñ—Ö –∫–æ–Ω—Ç—Ä–∏–±—É—Ç–æ—Ä—ñ–≤

## üéØ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: Environments

–î–ª—è —Ä—ñ–∑–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â (staging, production) –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ GitHub Environments:

```yaml
jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: production  # –∞–±–æ staging
```

–¶–µ –¥–æ–∑–≤–æ–ª–∏—Ç—å –º–∞—Ç–∏ —Ä—ñ–∑–Ω—ñ secrets –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞.

## üìö –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Ä–µ—Å—É—Ä—Å–∏

- [GitHub Secrets Documentation](https://docs.github.com/en/actions/security-guides/encrypted-secrets)
- [Docker Hub Access Tokens](https://docs.docker.com/docker-hub/access-tokens/)
- [SSH Key Generation](https://docs.github.com/en/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent)

## üÜò Troubleshooting

### "Permission denied (publickey)"

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ –ø—É–±–ª—ñ—á–Ω–∏–π –∫–ª—é—á –¥–æ–¥–∞–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä:
ssh-copy-id -i ~/.ssh/id_rsa.pub ubuntu@your-server-ip

# –ê–±–æ –¥–æ–¥–∞–π—Ç–µ –≤—Ä—É—á–Ω—É:
cat ~/.ssh/id_rsa.pub | ssh ubuntu@your-server-ip "mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys"
```

### "Error loading key: invalid format"

–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ –≤–∏ —Å–∫–æ–ø—ñ—é–≤–∞–ª–∏ **–≤–µ—Å—å** –∫–ª—é—á –≤–∫–ª—é—á–∞—é—á–∏ —Ä—è–¥–∫–∏ BEGIN —Ç–∞ END.

### Docker login failed

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ Access Token –∑–∞–º—ñ—Å—Ç—å –ø–∞—Ä–æ–ª—è Docker Hub.

---

**–ü—ñ—Å–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö secrets –≤–∞—à CI/CD –±—É–¥–µ –ø–æ–≤–Ω—ñ—Å—Ç—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º!** üöÄ
