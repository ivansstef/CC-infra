# Cinema Club Infrastructure

–¶–µ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π –º—ñ—Å—Ç–∏—Ç—å —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–∏–π –∫–æ–¥ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –ø—Ä–æ–µ–∫—Ç—É Cinema Club.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç—É

```
CC-infra/
‚îú‚îÄ‚îÄ .github/
‚îÇ   ‚îî‚îÄ‚îÄ workflows/
‚îÇ       ‚îú‚îÄ‚îÄ gitleaks.yml           # –°–∫–∞–Ω—É–≤–∞–Ω–Ω—è —Å–µ–∫—Ä–µ—Ç—ñ–≤
‚îÇ       ‚îú‚îÄ‚îÄ deploy_infra.yml       # –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏ (–º–∞–π–±—É—Ç–Ω—î)
‚îÇ       ‚îî‚îÄ‚îÄ deploy_app.yml         # –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫—É (–º–∞–π–±—É—Ç–Ω—î)
‚îú‚îÄ‚îÄ ansible/
‚îÇ   ‚îú‚îÄ‚îÄ roles/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ cinema/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ tasks/
‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ main.yml       # –ó–∞–≤–¥–∞–Ω–Ω—è –¥–ª—è —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ templates/
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ docker-compose.yml.j2  # –®–∞–±–ª–æ–Ω Docker Compose
‚îÇ   ‚îú‚îÄ‚îÄ deploy.yml                 # –û—Å–Ω–æ–≤–Ω–∏–π playbook
‚îÇ   ‚îî‚îÄ‚îÄ inventory.ini              # –Ü–Ω–≤–µ–Ω—Ç–∞—Ä—å —Å–µ—Ä–≤–µ—Ä—ñ–≤
‚îú‚îÄ‚îÄ .gitleaks.toml                 # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è Gitleaks
‚îî‚îÄ‚îÄ README.md                      # –¶–µ–π —Ñ–∞–π–ª
```

## üéØ –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è

–¶–µ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π –∑–∞–±–µ–∑–ø–µ—á—É—î:

1. **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–æ–≤–∞–Ω–µ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è** - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ Ansible –¥–ª—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è Cinema Club
2. **–ë–µ–∑–ø–µ–∫—É** - —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –∫–æ–¥—É –Ω–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å —Å–µ–∫—Ä–µ—Ç—ñ–≤ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Gitleaks
3. **CI/CD –≥–æ—Ç–æ–≤–Ω—ñ—Å—Ç—å** - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –º–∞–π–±—É—Ç–Ω—å–æ—ó –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó –¥–µ–ø–ª–æ—é

## üöÄ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –í–∞—Ä—ñ–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ GitHub Actions (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)

1. **–ù–∞–ª–∞—à—Ç—É–π—Ç–µ GitHub Secrets** (–¥–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –≤ [GITHUB_SECRETS_SETUP.md](GITHUB_SECRETS_SETUP.md)):
   - `SERVER_IP` - IP –≤–∞—à–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
   - `SSH_USER` - –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á SSH
   - `SSH_PRIVATE_KEY` - –ø—Ä–∏–≤–∞—Ç–Ω–∏–π SSH –∫–ª—é—á
   - `DOCKER_USERNAME` - Docker Hub username
   - `DOCKER_PASSWORD` - Docker Hub token

2. **–ó–∞–ø—É—Å—Ç—ñ—Ç—å –¥–µ–ø–ª–æ–π**:
   - –ü–µ—Ä–µ–π–¥—ñ—Ç—å –≤ **Actions** ‚Üí **Deploy Infrastructure** ‚Üí **Run workflow**
   - –ê–±–æ –ø—Ä–æ—Å—Ç–æ –∑—Ä–æ–±—ñ—Ç—å push –≤ `main` - –¥–µ–ø–ª–æ–π –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ

3. **–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç**:
   ```
   http://your-server-ip:8080
   ```

### –í–∞—Ä—ñ–∞–Ω—Ç 2: –†—É—á–Ω–µ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è —á–µ—Ä–µ–∑ Ansible (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è)

1. –ù–∞–ª–∞—à—Ç—É–π—Ç–µ —Ñ–∞–π–ª `ansible/inventory.ini` –∑ –≤–∞—à–∏–º–∏ —Å–µ—Ä–≤–µ—Ä–∞–º–∏:
```ini
[cinema]
your-server-ip ansible_user=ubuntu ansible_ssh_private_key_file=~/.ssh/id_rsa
```

2. –ó–∞–ø—É—Å—Ç—ñ—Ç—å playbook:
```bash
cd ansible
ansible-playbook -i inventory.ini deploy.yml
```

### –©–æ —Ä–æ–±–∏—Ç—å Ansible playbook:

- ‚úÖ –û–Ω–æ–≤–ª—é—î —Å–∏—Å—Ç–µ–º—É Ubuntu
- ‚úÖ –í—Å—Ç–∞–Ω–æ–≤–ª—é—î –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ –ø–∞–∫–µ—Ç–∏ (git, python3, docker, docker-compose)
- ‚úÖ –ö–ª–æ–Ω—É—î —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π Cinema Club
- ‚úÖ –ù–∞–ª–∞—à—Ç–æ–≤—É—î Docker Compose
- ‚úÖ –ó–∞–ø—É—Å–∫–∞—î –¥–æ–¥–∞—Ç–æ–∫ –Ω–∞ –ø–æ—Ä—Ç—É 8080

## üîí –ë–µ–∑–ø–µ–∫–∞

–†–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Å–∫–∞–Ω—É—î—Ç—å—Å—è –Ω–∞ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å —Å–µ–∫—Ä–µ—Ç—ñ–≤:
- –ü—Ä–∏ –∫–æ–∂–Ω–æ–º—É push
- –ü—Ä–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ pull request
- –©–æ–¥–µ–Ω–Ω–æ –æ 4:00 —Ä–∞–Ω–∫—É

## üìã –í–∏–º–æ–≥–∏

**–¶—ñ–ª—å–æ–≤–∞ –û–°:** Ubuntu 22.04

**–ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ –Ω–∞ —Ü—ñ–ª—å–æ–≤–æ–º—É —Å–µ—Ä–≤–µ—Ä—ñ:**
- Python 3
- SSH –¥–æ—Å—Ç—É–ø

**–õ–æ–∫–∞–ª—å–Ω—ñ –≤–∏–º–æ–≥–∏:**
- Ansible 2.9+
- SSH –∫–ª—é—á –¥–ª—è –¥–æ—Å—Ç—É–ø—É –¥–æ —Å–µ—Ä–≤–µ—Ä–∞

## üîÆ CI/CD Pipelines

### Pipeline 1: Gitleaks ‚úÖ (–∞–∫—Ç–∏–≤–Ω–∏–π)
–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è —Å–µ–∫—Ä–µ—Ç—ñ–≤ –ø—Ä–∏ –∫–æ–∂–Ω–æ–º—É push, PR —Ç–∞ —â–æ–¥–µ–Ω–Ω–æ

### Pipeline 2: Deploy Infrastructure ‚úÖ (–∞–∫—Ç–∏–≤–Ω–∏–π)
- **–¢—Ä–∏–≥–µ—Ä–∏:** Push –≤ `main` (–∑–º—ñ–Ω–∏ –≤ `ansible/**`), —Ä—É—á–Ω–∏–π –∑–∞–ø—É—Å–∫
- **–©–æ —Ä–æ–±–∏—Ç—å:** 
  - –í—Å—Ç–∞–Ω–æ–≤–ª—é—î Ansible
  - –ü—ñ–¥–∫–ª—é—á–∞—î—Ç—å—Å—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞ —á–µ—Ä–µ–∑ SSH
  - –ó–∞–ø—É—Å–∫–∞—î Ansible playbook
  - –†–æ–∑–≥–æ—Ä—Ç–∞—î –≤—Å—é —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É
- **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:** –ü–æ—Ç—Ä–µ–±—É—î GitHub Secrets (–¥–∏–≤. [GITHUB_SECRETS_SETUP.md](GITHUB_SECRETS_SETUP.md))

### Pipeline 3: Deploy Application ‚úÖ (–∞–∫—Ç–∏–≤–Ω–∏–π)
- **–¢—Ä–∏–≥–µ—Ä–∏:** –†—É—á–Ω–∏–π –∑–∞–ø—É—Å–∫, webhook –≤—ñ–¥ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é CinemaClub
- **–©–æ —Ä–æ–±–∏—Ç—å:**
  - –ó–±–∏—Ä–∞—î Docker image Cinema Club
  - –ü—É–±–ª—ñ–∫—É—î –Ω–∞ Docker Hub
  - –î–µ–ø–ª–æ—ó—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
  - –ü–µ—Ä–µ–≤—ñ—Ä—è—î –¥–æ—Å—Ç—É–ø–Ω—ñ—Å—Ç—å
- **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è:** –ü–æ—Ç—Ä–µ–±—É—î Docker Hub credentials –≤ GitHub Secrets

## üìù –ü—Ä–∏–º—ñ—Ç–∫–∏

- –í—Å—ñ —á—É—Ç–ª–∏–≤—ñ –¥–∞–Ω—ñ –ø–æ–≤–∏–Ω–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—Ç–∏—Å—è –≤ Ansible Vault –∞–±–æ GitHub Secrets
- –ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ—î–º –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—é –≤ `ansible/roles/cinema/templates/`
- –õ–æ–≥–∏ —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –Ω–∞ —Ü—ñ–ª—å–æ–≤–æ–º—É —Å–µ—Ä–≤–µ—Ä—ñ

## ü§ù –í–Ω–µ—Å–æ–∫

1. –°—Ç–≤–æ—Ä—ñ—Ç—å feature branch
2. –í–Ω–µ—Å—ñ—Ç—å –∑–º—ñ–Ω–∏
3. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—å, —â–æ Gitleaks –Ω–µ –≤–∏—è–≤–∏–≤ —Å–µ–∫—Ä–µ—Ç—ñ–≤
4. –°—Ç–≤–æ—Ä—ñ—Ç—å Pull Request

## üìß –ö–æ–Ω—Ç–∞–∫—Ç–∏

–†–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π –ø—Ä–æ–µ–∫—Ç—É: [CinemaClub](https://github.com/ivansstef/CinemaClub.git)

---
*–û—Å—Ç–∞–Ω–Ω—î –æ–Ω–æ–≤–ª–µ–Ω–Ω—è: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è deploy –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞*
